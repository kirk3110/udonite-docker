FROM alpine:3.20

# mongodb-tools, bash, tzdata をインストール
RUN apk add --no-cache mongodb-tools tzdata bash

# スクリプト・crontab 配置
COPY backup.sh /usr/local/bin/backup.sh
COPY entrypoint.sh /entrypoint.sh
COPY crontab.template /crontab.template
RUN chmod +x /usr/local/bin/backup.sh /entrypoint.sh

# バックアップ先
VOLUME ["/backups"]

# cron の設定を環境変数から生成し、crond をフォアグラウンドで起動
ENTRYPOINT ["/entrypoint.sh"]
