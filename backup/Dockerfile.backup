FROM alpine:3.20

# mongodump/mongorestore と cron, tz
RUN apk add --no-cache mongodb-tools dcron tzdata bash

# タイムゾーン（必要なら Asia/Tokyo に）
ENV TZ=Asia/Tokyo

# スクリプト・crontab 配置
COPY backup.sh /usr/local/bin/backup.sh
COPY crontab /etc/crontabs/root
RUN chmod +x /usr/local/bin/backup.sh

# バックアップ先
VOLUME ["/backups"]

# cron フォアグラウンド
CMD ["crond", "-f", "-l", "8"]
